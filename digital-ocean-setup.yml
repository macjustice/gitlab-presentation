---
  # cribbed from here https://gist.github.com/rdhyee/7047660
  - name: Launch Droplet
    hosts: local
    gather_facts: false
    tasks:
      - include_vars: "digital-ocean-vars.yml"
      
      - name: Launch Droplet
        local_action:
          digital_ocean:
            state: present
            command: droplet
            name: munki-demo
            api_token: "{{ Digital_Ocean_Token }}"
          register: munki_droplet

      - name: print info
        local_action:
          debug:
            msg: "ID is {{ munki_droplet.droplet.id }} IP is {{ munki_droplet.droplet.ip_address }}"

      - name: Add new droplet to host group
        local_action:
          add_host:
            hostname: "{{ munki_droplet.droplet.ip_address }}"
            groupname: launched

      - name: Wait for SSH to come up
        local_action:
          wait_for:
            host: "{{ munki_droplet.droplet.ip_address }}"
            port: 22
            delay: 60
            timeout: 320
            state: started
